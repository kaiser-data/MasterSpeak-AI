#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

echo "ğŸ” Running pre-commit checks..."

# Frontend checks
echo "ğŸ“± Frontend: Linting..."
pnpm lint --max-warnings 0 || {
  echo "âŒ Linting failed"
  exit 1
}

echo "ğŸ“± Frontend: Type checking..."
pnpm type-check || {
  echo "âŒ Type checking failed"
  exit 1
}

echo "ğŸ“± Frontend: Testing changed files..."
pnpm test:changed || {
  echo "âŒ Frontend tests failed"
  exit 1
}

# Backend checks
echo "ğŸ Backend: Linting..."
cd backend && python -m black --check . && python -m isort --check-only . || {
  echo "âŒ Backend linting failed"
  cd ..
  exit 1
}

echo "ğŸ Backend: Type checking..."
python -m mypy backend/ --ignore-missing-imports || {
  echo "âŒ Backend type checking failed"
  cd ..
  exit 1
}

echo "ğŸ Backend: Testing..."
python -m pytest test/unit/ -q || {
  echo "âŒ Backend tests failed"
  cd ..
  exit 1
}

cd ..

echo "âœ… All pre-commit checks passed!"